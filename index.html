<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Sheets</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600&display=swap');

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #1d1d1f;
            padding: 20px;
        }

        .motherbox {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 18px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 600px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .motherbox:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #1d1d1f;
        }

        .info-section {
            /* No margin-bottom to rely on input-group margins */
        }

        .calculator-section {
            margin: 0 0 40px 0;
        }

        .input-group {
            margin: 20px 0;
            text-align: left;
            position: relative;
        }

        .beer-style-group {
            margin: 20px 0 0 0;
        }

        .columns-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .column {
            flex: 1;
            max-width: calc(50% - 10px);
        }

        .input-container {
            position: relative;
            width: 100%;
        }

        input {
            width: 100%;
            height: 55px;
            padding: 20px 12px 10px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 10px;
            font-size: 16px;
            background-color: #f5f5f7;
            box-sizing: border-box;
            transition: border-color 0.2s ease;
        }

        input:focus {
            outline: none;
            border-color: #007aff;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
        }

        label {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: 400;
            color: #6e6e73;
            pointer-events: none;
            transition: all 0.2s ease;
        }

        input:focus + label,
        input:not(:placeholder-shown) + label,
        #color-input.color-selected + label {
            top: 8px;
            transform: translateY(0);
            font-size: 12px;
            font-weight: 500;
            color: #1d1d1f;
        }

        .input-with-suffix {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-with-suffix input {
            padding-right: 30px;
        }

        .input-with-suffix .suffix {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: 500;
            color: #6e6e73;
            pointer-events: none;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .result {
            margin-top: 20px;
            text-align: left;
        }

        .result h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
            margin: 0 0 10px 0;
        }

        .result-box {
            background-color: #f5f5f7;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #og-value, #calorie-value, #corrected-sg-value, #corrected-p-value {
            font-size: 18px;
            font-weight: 500;
            color: #007aff;
            margin: 0;
            line-height: 1.4;
        }

        #color-input {
            cursor: pointer;
        }

        .color-strip {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, 
                #F6F513 0%, #F6F513 14.28%,
                #BF923B 14.28%, #BF923B 28.56%,
                #BC6733 28.56%, #BC6733 42.84%,
                #8D4C32 42.84%, #8D4C32 57.12%,
                #5D341A 57.12%, #5D341A 71.4%,
                #261716 71.4%, #261716 85.68%,
                #030403 85.68%, #030403 100%);
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            margin-top: 5px;
        }

        .color-strip.visible {
            display: block;
        }

        @media (max-width: 820px) {
            .motherbox {
                padding: 30px;
                width: 100%;
                max-width: 600px;
            }

            h1 {
                font-size: 24px;
            }

            label {
                font-size: 14px;
            }

            input {
                font-size: 14px;
                height: 50px;
                padding: 18px 12px 8px 12px;
            }

            input:focus + label,
            input:not(:placeholder-shown) + label,
            #color-input.color-selected + label {
                font-size: 10px;
                top: 7px;
            }

            .input-with-suffix .suffix {
                font-size: 14px;
            }

            .result h3 {
                font-size: 16px;
            }

            #og-value, #calorie-value, #corrected-sg-value, #corrected-p-value {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="motherbox">
        <h1>Technical Sheets</h1>
        
        <div class="info-section">
            <div class="input-group">
                <div class="input-container">
                    <input type="date" id="date" placeholder=" ">
                    <label for="date">Date</label>
                </div>
            </div>
            <div class="input-group">
                <div class="input-container">
                    <input type="text" id="beer" placeholder=" ">
                    <label for="beer">Beer Name</label>
                </div>
            </div>
            <div class="input-group beer-style-group">
                <div class="input-container">
                    <input type="text" id="beer-style" placeholder=" ">
                    <label for="beer-style">Beer Style</label>
                </div>
            </div>
            <div class="input-group">
                <div class="input-container">
                    <input type="text" id="color-input" readonly placeholder=" ">
                    <label for="color-input">Beer Color</label>
                    <div id="color-strip" class="color-strip"></div>
                </div>
            </div>
        </div>

        <div class="calculator-section">
            <div class="columns-container">
                <div class="column">
                    <div class="input-group">
                        <div class="input-container">
                            <input type="number" id="av" step="0.01" placeholder=" ">
                            <label for="av">ABV</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-container">
                            <input type="number" id="fg" step="0.001" placeholder=" ">
                            <label for="fg">Final Gravity</label>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="input-group">
                        <div class="input-with-suffix">
                            <input type="text" id="volume" placeholder=" ">
                            <label for="volume">Volume</label>
                            <span class="suffix">cl</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-with-suffix">
                            <input type="number" id="celsiusInput" placeholder=" ">
                            <label for="celsiusInput">Product Temperature</label>
                            <span class="suffix">°C</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="result">
                <h3>Results</h3>
                <div class="result-box">
                    <p id="og-value">Enter values to see Original Gravity</p>
                    <p id="calorie-value">Enter values to see Calories</p>
                    <p id="corrected-sg-value">Enter temperature and SG to see Corrected SG</p>
                    <p id="corrected-p-value"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function capitalizeWords(str) {
            return str.replace(/\b\w/g, char => char.toUpperCase());
        }

        function updateFieldsFromBeer() {
            const beerInput = document.getElementById('beer');
            const abvInput = document.getElementById('av');
            const volumeInput = document.getElementById('volume');
            
            let beerValue = beerInput.value;
            beerInput.value = capitalizeWords(beerValue);
            
            const abvMatch = beerValue.match(/(\d*\.?\d+)%/);
            if (abvMatch) {
                const abvValue = parseFloat(abvMatch[1]);
                abvInput.value = abvValue;
                abvInput.dispatchEvent(new Event('input'));
            } else {
                abvInput.value = '';
            }

            const volumeMatch = beerValue.match(/(\d*\.?\d+)cl/);
            if (volumeMatch) {
                const volumeValue = volumeMatch[1];
                volumeInput.value = volumeValue;
                volumeInput.dispatchEvent(new Event('input'));
            } else {
                volumeInput.value = '';
            }

            calculateAll();
        }

        function capitalizeBeerStyle() {
            const beerStyleInput = document.getElementById('beer-style');
            beerStyleInput.value = capitalizeWords(beerStyleInput.value);
        }

        function calculateAll() {
            const fg = parseFloat(document.getElementById('fg').value);
            const av = parseFloat(document.getElementById('av').value);
            const volume = parseFloat(document.getElementById('volume').value);
            const celsius = parseFloat(document.getElementById('celsiusInput').value);

            if (!isNaN(fg) && !isNaN(av)) {
                const a = 76.08;
                const b = 0.794;
                const c = 1.775;

                const numerator = (av * b * c) + (a * fg * fg);
                const denominator = (a * fg) + (av * b);
                const og = numerator / denominator;

                const calorieContent = 3621 * fg * (
                    (0.8114 * fg + 0.1886 * og - 1) + 
                    0.53 * ((og - fg) / (1.775 - og)) * (isNaN(volume) ? 1 : volume / 33)
                );

                document.getElementById('og-value').innerText = `Original Gravity: ${og.toFixed(3)}`;
                document.getElementById('calorie-value').innerText = `Calories: ${calorieContent.toFixed(0)} cal`;
            } else {
                document.getElementById('og-value').innerText = "Please enter FG and ABV for Original Gravity.";
                document.getElementById('calorie-value').innerText = "Please enter FG and ABV for Calories.";
            }

            if (!isNaN(celsius) && !isNaN(fg)) {
                const fahrenheit = (celsius * 9/5) + 32;
                const X = fahrenheit;
                const sgcf = 1.00130346 - 
                            (1.34722124 * Math.pow(10, -4) * X) + 
                            (2.04052596 * Math.pow(10, -6) * Math.pow(X, 2)) - 
                            (2.32820948 * Math.pow(10, -9) * Math.pow(X, 3));
                const Y = sgcf;
                const multipliedY = Y * 1000;
                const sgcfPoints = multipliedY % 1000;
                const Z = fg;
                const multipliedZ = Z * 1000;
                const observedSGPoints = multipliedZ % 1000;
                const correctedSGPoints = observedSGPoints + (sgcfPoints - 1);
                const correctedSG = (correctedSGPoints / 1000) + 1;
                const correctedP = 1000 * (correctedSG - 1) / 4;

                document.getElementById('corrected-sg-value').innerText = `Corrected SG: ${correctedSG.toFixed(3)}`;
                document.getElementById('corrected-p-value').innerText = `Corrected °P: ${correctedP.toFixed(3)}`;
            } else {
                document.getElementById('corrected-sg-value').innerText = "Please enter temperature and FG for Corrected SG.";
                document.getElementById('corrected-p-value').innerText = "";
            }
        }

        // Color picker functionality
        const colorInput = document.getElementById('color-input');
        const colorStrip = document.getElementById('color-strip');
        const colors = ['#F6F513', '#BF923B', '#BC6733', '#8D4C32', '#5D341A', '#261716', '#030403'];
        let isColorSelected = false;

        colorInput.addEventListener('click', () => {
            colorStrip.classList.toggle('visible');
        });

        colorStrip.addEventListener('click', (e) => {
            const rect = colorStrip.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const segmentWidth = rect.width / 7;
            const selectedIndex = Math.floor(x / segmentWidth);
            const selectedColor = colors[selectedIndex];
            
            colorInput.style.backgroundColor = selectedColor;
            const luminance = calculateLuminance(selectedColor);
            colorInput.style.color = luminance > 0.5 ? '#1d1d1f' : '#ffffff';
            colorInput.value = '';
            colorInput.classList.add('color-selected'); // Add class to trigger fly-out
            if (!isColorSelected) {
                isColorSelected = true;
            }
            colorStrip.classList.remove('visible');
        });

        function calculateLuminance(hex) {
            const rgb = hexToRgb(hex);
            return (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        document.addEventListener('click', (e) => {
            if (!colorInput.contains(e.target) && !colorStrip.contains(e.target)) {
                colorStrip.classList.remove('visible');
            }
        });

        const inputs = ['fg', 'av', 'celsiusInput', 'volume'];
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', calculateAll);
        });

        document.getElementById('beer').addEventListener('input', updateFieldsFromBeer);
        document.getElementById('beer-style').addEventListener('input', capitalizeBeerStyle);
    </script>
</body>
</html>
